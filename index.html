<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Intranet • 실적 관리 콘솔</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
html { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "맑은 고딕", sans-serif; }
.spin { animation: spin 1s cubic-bezier(.25,.8,.25,1) 1; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
</style>
</head>
<body class="min-h-screen bg-slate-100">

<header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
<div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
<div class="flex items-center gap-3">
<div class="w-9 h-9 rounded-2xl bg-slate-900 text-white grid place-items-center text-sm font-semibold">HR</div>
<div>
<h1 class="text-xl font-semibold text-slate-900">사내 인트라넷 • 실적 관리 콘솔</h1>
<p class="text-xs text-slate-500">Confidential — 내부 배포 전용</p>
</div>
</div>
<div class="text-right">
<div id="headerUser" class="text-sm text-slate-600">미로그인</div>
<button id="logoutBtn" class="hidden mt-1 text-xs text-slate-500 underline">로그아웃</button>
</div>
</div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8">
<section id="loginSection" class="grid place-items-center">
<div class="w-full max-w-md bg-white rounded-2xl shadow p-6 border border-slate-200">
<h2 class="text-lg font-semibold text-slate-900">사원 인증</h2>
<p class="text-sm text-slate-500 mt-1">사원번호는 닉네임 대체로 사용 가능합니다.</p>
<div class="mt-4 space-y-3">
<label class="block">
<span class="text-sm text-slate-600">사원명</span>
<input id="nameInput" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: 김사원" />
</label>
<label class="block">
<span class="text-sm text-slate-600">사원번호</span>
<input id="idInput" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: E-1024" />
</label>
<label class="block">
<span class="text-sm text-slate-600">비밀번호</span>
<input id="pwInput" type="password" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: admin123" />
</label>
<button id="loginBtn" class="w-full mt-2 py-2 rounded-xl bg-slate-900 text-white font-medium hover:bg-slate-800">접속</button>
</div>
<p class="text-xs text-slate-400 mt-4">최초 접속 시 자동 등록되며, 데이터는 Firebase Firestore에 저장됩니다.</p>
</div>
</section>

<section id="dashboard" class="hidden">
<div class="grid md:grid-cols-3 gap-5">
<div class="md:col-span-2 space-y-5">
<!-- 상태 카드 -->
<div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
<div class="flex items-center justify-between">
<div>
<h3 class="text-base font-semibold text-slate-900">개인 실적 현황</h3>
<p class="text-sm text-slate-500">이번 분기 누적 포인트</p>
</div>
<div class="text-right">
<div class="text-3xl font-extrabold text-slate-900" id="points">0</div>
<div class="text-xs text-slate-500">pt</div>
</div>
</div>
<div class="mt-4 grid sm:grid-cols-2 gap-3">
<div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
<div class="text-xs text-slate-500">성공 프로젝트</div>
<div id="wins" class="text-lg font-semibold">0</div>
</div>
<div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
<div class="text-xs text-slate-500">리스크 감수</div>
<div id="bets" class="text-lg font-semibold">0</div>
</div>
</div>
</div>

<!-- 더 많은 대시보드 UI는 기존과 동일 -->

<div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
<h3 class="text-base font-semibold text-slate-900">관리자 패널</h3>
<p class="text-sm text-slate-500 mb-3">관리자는 모든 유저 정보를 확인하고 비밀번호도 볼 수 있습니다.</p>
<ul id="adminUserList" class="text-sm space-y-2 max-h-64 overflow-auto"></ul>
</div>
</div>
<aside class="space-y-5">
<div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
<h3 class="text-base font-semibold text-slate-900">이번 달 실적 랭킹</h3>
<ol id="leaderboard" class="mt-3 space-y-2 text-sm"></ol>
</div>
</aside>
</div>
</section>
</main>

<footer class="max-w-6xl mx-auto px-4 pb-10 text-center text-xs text-slate-500">
© Intranet Simulation for RP — For friends only
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD_mkzYLfswDlHPgu1Z3Gk3Gas1itZK4qE",
  authDomain: "sornlzj-2.firebaseapp.com",
  projectId: "sornlzj-2",
  storageBucket: "sornlzj-2.appspot.com",
  messagingSenderId: "282242113719",
  appId: "1:282242113719:web:dc7e1b9817961d3ce66d32"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const loginBtn = document.getElementById('loginBtn');
const nameInput = document.getElementById('nameInput');
const idInput = document.getElementById('idInput');
const pwInput = document.getElementById('pwInput');

let currentUser = null;
const adminId = 'admin';
const adminPassword = 'admin123'; // 관리자 비밀번호 설정

loginBtn.addEventListener('click', async ()=>{
  const name = nameInput.value.trim();
  const id = idInput.value.trim();
  const pw = pwInput.value.trim();
  if(!name||!id||!pw){ alert('모든 필드를 입력하세요.'); return; }

  currentUser = {name,id,pw,points:100,wins:0,bets:0};
  const userRef = doc(db,'users',id);
  await setDoc(userRef,currentUser,{merge:true});

  document.getElementById('loginSection').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('headerUser').textContent = name + ' · ' + id;

  setupRealtime();
});

function setupRealtime(){
  const usersCol = collection(db,'users');
  onSnapshot(usersCol,snapshot=>{
    const leaderboard = document.getElementById('leaderboard');
    const adminList = document.getElementById('adminUserList');
    const users = [];
    snapshot.forEach(doc=>{
      users.push(doc.data());
    });

    // 랭킹 정렬
    users.sort((a,b)=>b.points - a.points);
    leaderboard.innerHTML = '';
    users.forEach((u,i)=>{
      const li = document.createElement('li');
      li.textContent = `${i+1}. ${u.name} (${u.id}) — ${u.points}pt`;
      leaderboard.appendChild(li);
    });

    // 관리자만 비번 보기
    adminList.innerHTML = '';
    if(currentUser.id===adminId && currentUser.pw===adminPassword){
      users.forEach(u=>{
        const li = document.createElement('li');
        li.textContent = `${u.name} (${u.id}) — ${u.points}pt / 비번: ${u.pw}`;
        adminList.appendChild(li);
      });
    }
  });
}
</script>

</body>
</html>
