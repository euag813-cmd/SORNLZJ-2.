<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Intranet • 실적 관리 콘솔</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "맑은 고딕", sans-serif; }
    .spin { animation: spin 1s cubic-bezier(.25,.8,.25,1) 1; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen bg-slate-100">
  <!-- 헤더 -->
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-2xl bg-slate-900 text-white grid place-items-center text-sm font-semibold">HR</div>
        <div>
          <h1 class="text-xl font-semibold text-slate-900">사내 인트라넷 • 실적 관리 콘솔</h1>
          <p class="text-xs text-slate-500">Confidential — 내부 배포 전용</p>
        </div>
      </div>
      <div class="text-right">
        <div id="headerUser" class="text-sm text-slate-600">미로그인</div>
        <button id="logoutBtn" class="hidden mt-1 text-xs text-slate-500 underline">로그아웃</button>
      </div>
    </div>
  </header>

  <!-- 로그인 카드 -->
  <main class="max-w-6xl mx-auto px-4 py-8">
    <section id="loginSection" class="grid place-items-center">
      <div class="w-full max-w-md bg-white rounded-2xl shadow p-6 border border-slate-200">
        <h2 class="text-lg font-semibold text-slate-900">사원 인증</h2>
        <p class="text-sm text-slate-500 mt-1">사원번호는 닉네임 대체로 사용 가능합니다.</p>
        <div class="mt-4 space-y-3">
          <label class="block">
            <span class="text-sm text-slate-600">사원명</span>
            <input id="nameInput" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: 김사원" />
          </label>
          <label class="block">
            <span class="text-sm text-slate-600">사원번호</span>
            <input id="idInput" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: E-1024" />
          </label>
          <button id="loginBtn" class="w-full mt-2 py-2 rounded-xl bg-slate-900 text-white font-medium hover:bg-slate-800">접속</button>
        </div>
        <p class="text-xs text-slate-400 mt-4">최초 접속 시 자동 등록되며, 데이터는 로컬 저장소(LocalStorage)에만 저장됩니다.</p>
      </div>
    </section>

    <!-- 대시보드 -->
    <section id="dashboard" class="hidden">
      <div class="grid md:grid-cols-3 gap-5">
        <div class="md:col-span-2 space-y-5">
          <!-- 상태 카드 -->
          <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-base font-semibold text-slate-900">개인 실적 현황</h3>
                <p class="text-sm text-slate-500">이번 분기 누적 포인트</p>
              </div>
              <div class="text-right">
                <div class="text-3xl font-extrabold text-slate-900" id="points">0</div>
                <div class="text-xs text-slate-500">pt</div>
              </div>
            </div>
            <div class="mt-4 grid sm:grid-cols-2 gap-3">
              <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
                <div class="text-xs text-slate-500">성공 프로젝트</div>
                <div id="wins" class="text-lg font-semibold">0</div>
              </div>
              <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
                <div class="text-xs text-slate-500">리스크 감수</div>
                <div id="bets" class="text-lg font-semibold">0</div>
              </div>
            </div>
          </div>

          <!-- 업무 보고 -->
          <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
            <div class="flex items-center justify-between mb-4">
              <div>
                <h3 class="text-base font-semibold text-slate-900">업무 보고</h3>
                <p class="text-sm text-slate-500">표면상 보고 절차지만 내부적으로 확률 배정된 결과가 산출됩니다.</p>
              </div>
              <div id="reportCooldown" class="text-xs text-slate-500"></div>
            </div>
            <div class="grid sm:grid-cols-[1fr_auto] gap-4 items-center">
              <button id="reportBtn" class="py-3 rounded-xl bg-slate-900 text-white font-medium hover:bg-slate-800">보고서 제출</button>
              <div class="w-24 h-24 grid place-items-center rounded-full border border-slate-300" id="wheelBox">
                <div id="wheel" class="w-16 h-16 rounded-full border-4 border-slate-900 grid place-items-center text-sm font-bold">HR</div>
              </div>
            </div>
            <div class="mt-4">
              <details class="rounded-xl bg-slate-50 border border-slate-200 px-4 py-3">
                <summary class="cursor-pointer text-sm text-slate-700">확률표 보기</summary>
                <div class="mt-2 text-sm text-slate-600">
                  <ul class="list-disc pl-5 space-y-1">
                    <li>프로젝트 대성공 +150pt (5%)</li>
                    <li>상사 칭찬 +80pt (10%)</li>
                    <li>성과 인정 +50pt (15%)</li>
                    <li>무난한 보고 0pt (20%)</li>
                    <li>보고 누락 -30pt (20%)</li>
                    <li>정치 전개 실패 -60pt (20%)</li>
                    <li>성과 갈취 -100pt (10%)</li>
                  </ul>
                </div>
              </details>
            </div>
            <div id="reportResult" class="mt-4 text-sm"></div>
          </div>

          <!-- 프로젝트 투자 -->
          <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
            <h3 class="text-base font-semibold text-slate-900">프로젝트 투자</h3>
            <p class="text-sm text-slate-500 mb-3">보유 포인트에서 일부를 배정해 결과에 따라 수익 또는 손실을 기록합니다.</p>
            <div class="grid sm:grid-cols-3 gap-3">
              <label class="block">
                <span class="text-xs text-slate-600">배팅 포인트</span>
                <input id="betInput" type="number" min="1" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: 20" />
              </label>
              <label class="block">
                <span class="text-xs text-slate-600">리스크 등급</span>
                <select id="riskSelect" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30">
                  <option value="conservative">보수형 (성공 60%, 1.5배)</option>
                  <option value="balanced">중립형 (성공 50%, 2배)</option>
                  <option value="aggressive">공격형 (성공 35%, 3배)</option>
                </select>
              </label>
              <div class="flex items-end">
                <button id="betBtn" class="w-full py-2.5 rounded-xl bg-slate-900 text-white font-medium hover:bg-slate-800">투자 집행</button>
              </div>
            </div>
            <div id="betResult" class="mt-3 text-sm"></div>
          </div>

          <!-- HR 이벤트 -->
          <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
            <div class="flex items-center justify-between mb-3">
              <h3 class="text-base font-semibold text-slate-900">HR 이벤트</h3>
              <div id="eventCooldown" class="text-xs text-slate-500"></div>
            </div>
            <button id="eventBtn" class="py-2 rounded-xl bg-yellow-500 text-white font-medium hover:bg-yellow-400">랜덤 이벤트</button>
            <div id="eventResult" class="mt-3 text-sm"></div>
          </div>
        </div>

        <div class="space-y-5">
          <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
            <h3 class="text-base font-semibold text-slate-900">공지 사항</h3>
            <p class="text-sm text-slate-500 mt-1">데이터는 로컬 저장소 기반이며, 실험용으로만 활용하세요.</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== 데이터 관리 =====
    let users = JSON.parse(localStorage.getItem('users')||'{}');
    let current = null;

    function persist(){ localStorage.setItem('users', JSON.stringify(users)); }

    function loadUsers(){ return users; }

    function ensureUser(){
      if(!current){
        const name = prompt('이름을 입력하세요') || '익명';
        const id = prompt('사원번호 입력') || `U${Date.now()}`;
        if(!users[id]) users[id] = {id,name,points:0,wins:0,bets:0};
        current = users[id];
        persist();
      }
    }

    function render(){
      if(!current) return;
      document.getElementById('points').textContent = current.points;
      document.getElementById('wins').textContent = current.wins;
      document.getElementById('bets').textContent = current.bets;
      document.getElementById('headerUser').textContent = `${current.name} (${current.id})`;
    }

    // ===== 로그인 =====
    const loginSection = document.getElementById('loginSection');
    const dashboard = document.getElementById('dashboard');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const nameInput = document.getElementById('nameInput');
    const idInput = document.getElementById('idInput');

    loginBtn.addEventListener('click',()=>{
      const name = nameInput.value.trim();
      const id = idInput.value.trim();
      if(!name||!id){ alert('이름과 사원번호를 입력하세요'); return; }
      if(!users[id]) users[id]={id,name,points:0,wins:0,bets:0};
      current=users[id]; persist();
      loginSection.classList.add('hidden'); dashboard.classList.remove('hidden');
      logoutBtn.classList.remove('hidden');
      render();
    });

    logoutBtn.addEventListener('click',()=>{
      current=null; loginSection.classList.remove('hidden'); dashboard.classList.add('hidden');
      logoutBtn.classList.add('hidden');
    });

    // ===== 보고서 제출 =====
    const reportBtn = document.getElementById('reportBtn');
    const wheel = document.getElementById('wheel');
    const reportResult = document.getElementById('reportResult');

    const reportRewards = [
      {text:'프로젝트 대성공 +150pt',points:150,prob:0.05},
      {text:'상사 칭찬 +80pt',points:80,prob:0.10},
      {text:'성과 인정 +50pt',points:50,prob:0.15},
      {text:'무난한 보고 0pt',points:0,prob:0.20},
      {text:'보고 누락 -30pt',points:-30,prob:0.20},
      {text:'정치 전개 실패 -60pt',points:-60,prob:0.20},
      {text:'성과 갈취 -100pt',points:-100,prob:0.10},
    ];

    function weightedRandom(items){
      let r=Math.random(); let sum=0;
      for(const it of items){ sum+=it.prob; if(r<sum) return it; }
      return items[items.length-1];
    }

    reportBtn.addEventListener('click',()=>{
      const res = weightedRandom(reportRewards);
      current.points += res.points;
      if(res.points>0) current.wins++; current.bets++;
      persist(); render();
      reportResult.textContent = res.text;
      wheel.classList.add('spin'); setTimeout(()=>{wheel.classList.remove('spin');},1000);
    });

    // ===== 프로젝트 투자 =====
    const betBtn = document.getElementById('betBtn');
    const betInput = document.getElementById('betInput');
    const riskSelect = document.getElementById('riskSelect');
    const betResult = document.getElementById('betResult');

    betBtn.addEventListener('click',()=>{
      let amt = parseInt(betInput.value,10);
      if(!amt||amt>current.points){ alert('포인트 확인'); return; }
      const risk = riskSelect.value;
      let successRate=0.5, multiplier=2;
      if(risk==='conservative'){successRate=0.6; multiplier=1.5;}
      else if(risk==='balanced'){successRate=0.5; multiplier=2;}
      else if(risk==='aggressive'){successRate=0.35; multiplier=3;}
      current.bets++;
      if(Math.random()<successRate){
        const gain=Math.floor(amt*multiplier);
        current.points+=gain; betResult.textContent=`성공! ${gain}pt 획득`;
      }else{
        current.points-=amt; betResult.textContent=`실패... ${amt}pt 손실`;
      }
      persist(); render();
    });

    // ===== HR 이벤트 =====
    const eventBtn = document.getElementById('eventBtn');
    const eventResult = document.getElementById('eventResult');

    const events = [
      {text:'팀 회식 보너스 +50pt',points:50},
      {text:'업무 과중 패널티 -40pt',points:-40},
      {text:'사내 칭찬 +30pt',points:30},
      {text:'데이터 유출 경고 -50pt',points:-50}
    ];

    eventBtn.addEventListener('click',()=>{
      const e = events[Math.floor(Math.random()*events.length)];
      current.points+=e.points; persist(); render();
      eventResult.textContent = e.text;
    });

    // ===== 관리자 패널 =====
    const ADMIN_PASSWORD = 'admin123';
    let adminMode=false;

    const adminBtn = document.createElement('button');
    adminBtn.textContent='관리자 모드';
    adminBtn.className='mt-2 py-1 px-2 rounded-xl bg-yellow-500 text-white text-sm hover:bg-yellow-400';
    adminBtn.addEventListener('click',()=>{
      const pw = prompt('관리자 비밀번호 입력');
      if(pw===ADMIN_PASSWORD){ adminMode=true; renderAdminPanel(); }
      else alert('비밀번호 틀림');
    });
    document.querySelector('header > div').appendChild(adminBtn);

    function renderAdminPanel(){
      let panel = document.getElementById('adminPanel');
      if(!panel){
        panel=document.createElement('div'); panel.id='adminPanel';
        panel.className='bg-white rounded-2xl shadow p-6 border border-red-400 mt-5';
        document.querySelector('main').prepend(panel);
      }
      const usersArr = Object.values(loadUsers());
      panel.innerHTML=`<h3 class="text-base font-semibold text-red-700">관리자 패널</h3>
        <p class="text-sm text-slate-500 mb-3">모든 유저 관리</p>
        <table class="w-full text-sm border-collapse">
          <thead>
            <tr>
              <th class="border px-2 py-1">이름</th>
              <th class="border px-2 py-1">ID</th>
              <th class="border px-2 py-1">포인트</th>
              <th class="border px-2 py-1">성공/배팅</th>
              <th class="border px-2 py-1">조작</th>
            </tr>
          </thead>
          <tbody>
            ${usersArr.map(u=>`<tr>
              <td class="border px-2 py-1">${u.name}</td>
              <td class="border px-2 py-1">${u.id}</td>
              <td class="border px-2 py-1">
                <input type="number" value="${u.points}" data-id="${u.id}" class="w-20 border px-1 py-0.5 rounded"/>
              </td>
              <td class="border px-2 py-1">${u.wins} / ${u.bets}</td>
              <td class="border px-2 py-1">
                <button data-id="${u.id}" class="delBtn text-xs py-0.5 px-1 bg-rose-500 text-white rounded hover:bg-rose-400">삭제</button>
              </td>
            </tr>`).join('')}
          </tbody>
        </table>`;

      panel.querySelectorAll('input[type=number]').forEach(input=>{
        input.addEventListener('change',e=>{
          const id=e.target.dataset.id, val=parseInt(e.target.value,10);
          if(Number.isFinite(val)){ users[id].points=val; if(current?.id===id) current.points=val; persist(); render(); }
        });
      });

      panel.querySelectorAll('.delBtn').forEach(btn=>{
        btn.addEventListener('click',e=>{
          const id=e.target.dataset.id;
          if(confirm(`${id} 사용자 삭제?`)){
            delete users[id];
            if(current?.id===id){current=null; loginSection.classList.remove('hidden'); dashboard.classList.add('hidden'); logoutBtn.classList.add('hidden');}
            persist(); renderAdminPanel();
          }
        });
      });
    }
  </script>
</body>
</html>
