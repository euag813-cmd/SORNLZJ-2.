<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intranet • 실적 관리 콘솔</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-database-compat.js"></script>
<style>
html { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "맑은 고딕", sans-serif; }
.spin { animation: spin 1s cubic-bezier(.25,.8,.25,1) 1; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
</style>
</head>
<body class="min-h-screen bg-slate-100">
<header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200">
<div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-9 h-9 rounded-2xl bg-slate-900 text-white grid place-items-center text-sm font-semibold">HR</div>
    <div>
      <h1 class="text-xl font-semibold text-slate-900">사내 인트라넷 • 실적 관리 콘솔</h1>
      <p class="text-xs text-slate-500">Confidential — 내부 배포 전용</p>
    </div>
  </div>
  <div class="text-right">
    <div id="headerUser" class="text-sm text-slate-600">미로그인</div>
    <button id="logoutBtn" class="hidden mt-1 text-xs text-slate-500 underline">로그아웃</button>
  </div>
</div>
</header>

<main class="max-w-6xl mx-auto px-4 py-8">
<section id="loginSection" class="grid place-items-center">
  <div class="w-full max-w-md bg-white rounded-2xl shadow p-6 border border-slate-200">
    <h2 class="text-lg font-semibold text-slate-900">사원 인증</h2>
    <p class="text-sm text-slate-500 mt-1">사원번호는 닉네임 대체로 사용 가능합니다.</p>
    <div class="mt-4 space-y-3">
      <label class="block">
        <span class="text-sm text-slate-600">사원명</span>
        <input id="nameInput" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: 김사원" />
      </label>
      <label class="block">
        <span class="text-sm text-slate-600">사원번호</span>
        <input id="idInput" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-slate-900/30" placeholder="예: E-1024" />
      </label>
      <button id="loginBtn" class="w-full mt-2 py-2 rounded-xl bg-slate-900 text-white font-medium hover:bg-slate-800">접속</button>
    </div>
    <p class="text-xs text-slate-400 mt-4">최초 접속 시 자동 등록되며, 데이터는 실시간 DB에 저장됩니다.</p>
  </div>
</section>

<section id="dashboard" class="hidden">
<div class="grid md:grid-cols-3 gap-5">
  <div class="md:col-span-2 space-y-5">
    <!-- 개인 실적 -->
    <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-base font-semibold text-slate-900">개인 실적 현황</h3>
          <p class="text-sm text-slate-500">이번 분기 누적 포인트</p>
        </div>
        <div class="text-right">
          <div class="text-3xl font-extrabold text-slate-900" id="points">0</div>
          <div class="text-xs text-slate-500">pt</div>
        </div>
      </div>
      <div class="mt-4 grid sm:grid-cols-2 gap-3">
        <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
          <div class="text-xs text-slate-500">성공 프로젝트</div>
          <div id="wins" class="text-lg font-semibold">0</div>
        </div>
        <div class="p-4 rounded-xl bg-slate-50 border border-slate-200">
          <div class="text-xs text-slate-500">리스크 감수</div>
          <div id="bets" class="text-lg font-semibold">0</div>
        </div>
      </div>
    </div>

    <!-- 업무/투자/이벤트 -->
    <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
      <div class="grid sm:grid-cols-3 gap-3">
        <button id="reportBtn" class="py-2 px-3 rounded-xl bg-green-500 text-white font-medium hover:bg-green-600">업무 보고</button>
        <button id="investBtn" class="py-2 px-3 rounded-xl bg-yellow-500 text-white font-medium hover:bg-yellow-600">리스크 투자</button>
        <button id="eventBtn" class="py-2 px-3 rounded-xl bg-blue-500 text-white font-medium hover:bg-blue-600">랜덤 이벤트</button>
      </div>
      <div id="actionResult" class="mt-4 text-sm"></div>
    </div>

    <!-- 로그 -->
    <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
      <h3 class="text-base font-semibold text-slate-900">활동 로그</h3>
      <ul id="logList" class="mt-3 space-y-2 text-sm text-slate-700 max-h-64 overflow-auto"></ul>
    </div>
  </div>

  <aside class="space-y-5">
    <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
      <h3 class="text-base font-semibold text-slate-900">이번 달 실적 랭킹</h3>
      <ol id="leaderboard" class="mt-3 space-y-2 text-sm"></ol>
    </div>
    <div class="bg-white rounded-2xl shadow p-6 border border-slate-200">
      <h3 class="text-base font-semibold text-slate-900">사내 공지</h3>
      <ul class="mt-3 text-sm text-slate-700 space-y-2">
        <li>• 데이터는 실시간으로 공유됩니다.</li>
        <li>• 관리자 패널로 점수/로그를 조정할 수 있습니다.</li>
      </ul>
    </div>
    <div id="adminPanel" class="bg-white rounded-2xl shadow p-6 border border-slate-200 hidden">
      <h3 class="text-base font-semibold text-slate-900">관리자 패널</h3>
      <button id="resetScoresBtn" class="mt-2 py-1 px-2 bg-red-500 text-white rounded hover:bg-red-600">모든 점수 초기화</button>
    </div>
  </aside>
</div>
</section>
</main>

<footer class="max-w-6xl mx-auto px-4 pb-10 text-center text-xs text-slate-500">
© Intranet Simulation for RP — For friends only
</footer>

<script>
// ===== Firebase 초기화 =====
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN.firebaseapp.com",
  databaseURL: "https://YOUR_DOMAIN.firebaseio.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_DOMAIN.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== 상태 =====
let current = null;

// ===== 유틸 =====
const fmt = n => new Intl.NumberFormat('ko-KR').format(n);
const now = () => Date.now();

// ===== UI 요소 =====
const loginSection = document.getElementById('loginSection');
const dashboard = document.getElementById('dashboard');
const headerUser = document.getElementById('headerUser');
const logoutBtn = document.getElementById('logoutBtn');

const nameInput = document.getElementById('nameInput');
const idInput = document.getElementById('idInput');
const loginBtn = document.getElementById('loginBtn');

const pointsEl = document.getElementById('points');
const winsEl = document.getElementById('wins');
const betsEl = document.getElementById('bets');
const logList = document.getElementById('logList');
const leaderboard = document.getElementById('leaderboard');
const actionResult = document.getElementById('actionResult');
const adminPanel = document.getElementById('adminPanel');
const resetScoresBtn = document.getElementById('resetScoresBtn');

const reportBtn = document.getElementById('reportBtn');
const investBtn = document.getElementById('investBtn');
const eventBtn = document.getElementById('eventBtn');

// ===== 로그인 =====
loginBtn.onclick = () => {
  const name = nameInput.value.trim();
  const id = idInput.value.trim();
  if(!name || !id) return alert('이름과 사원번호를 입력해주세요.');
  current = { name, id, points:0, wins:0, bets:0 };
  headerUser.textContent = `${name} (${id})`;
  loginSection.classList.add('hidden');
  dashboard.classList.remove('hidden');
  logoutBtn.classList.remove('hidden');
  if(id === 'ADMIN') adminPanel.classList.remove('hidden');
  db.ref('users/'+id).set(current);
  attachRealtime();
};

// ===== 로그아웃 =====
logoutBtn.onclick = () => location.reload();

// ===== 실시간 반영 =====
function attachRealtime(){
  db.ref('users').on('value', snapshot=>{
    const users = snapshot.val() || {};
    // 개인 실적
    const me = users[current.id] || {};
    pointsEl.textContent = fmt(me.points||0);
    winsEl.textContent = fmt(me.wins||0);
    betsEl.textContent = fmt(me.bets||0);

    // 로그
    const logs = Object.values(users).flatMap(u=>u.logs||[]);
    logList.innerHTML = '';
    logs.sort((a,b)=>b.time-a.time).forEach(l=>{
      const li = document.createElement('li');
      li.textContent = `[${new Date(l.time).toLocaleTimeString()}] ${l.text}`;
      logList.appendChild(li);
    });

    // 랭킹
    const ranked = Object.values(users).sort((a,b)=>b.points-(a.points||0));
    leaderboard.innerHTML = '';
    ranked.slice(0,10).forEach(u=>{
      const li = document.createElement('li');
      li.textContent = `${u.name} - ${u.points||0}pt`;
      leaderboard.appendChild(li);
    });
  });
}

// ===== 액션 =====
function addLog(text){
  db.ref('users/'+current.id+'/logs').push({text,time:now()});
}

reportBtn.onclick = ()=>{
  current.points += 10;
  current.wins += 1;
  db.ref('users/'+current.id).update({points:current.points,wins:current.wins});
  addLog('업무 보고 완료 +10pt');
  actionResult.textContent='업무 보고 완료! +10pt';
};
investBtn.onclick = ()=>{
  const gain = Math.floor(Math.random()*20-5);
  current.points += gain;
  current.bets += 1;
  db.ref('users/'+current.id).update({points:current.points,bets:current.bets});
  addLog(`리스크 투자 ${gain>=0?'+':'-'}${Math.abs(gain)}pt`);
  actionResult.textContent=`리스크 투자 결과: ${gain>=0?'+':'-'}${Math.abs(gain)}pt`;
};
eventBtn.onclick = ()=>{
  const gain = Math.floor(Math.random()*50-25);
  current.points += gain;
  db.ref('users/'+current.id).update({points:current.points});
  addLog(`랜덤 이벤트 ${gain>=0?'+':'-'}${Math.abs(gain)}pt`);
  actionResult.textContent=`랜덤 이벤트 결과: ${gain>=0?'+':'-'}${Math.abs(gain)}pt`;
};

// ===== 관리자 =====
resetScoresBtn.onclick = ()=>{
  if(!confirm('모든 점수를 초기화하시겠습니까?')) return;
  db.ref('users').once('value').then(snapshot=>{
    const users = snapshot.val()||{};
    Object.keys(users).forEach(uid=>{
      db.ref('users/'+uid).update({points:0,wins:0,bets:0,logs:[]});
    });
  });
};
</script>
</body>
</html>
